/*! app-router-lineman - v0.1.0 - 2013-07-12 */
(function(t){"use strict";t.App=function(t){return function(r,n){var o,e,i,u,s=["Router","RouteRecognizer","RSVP"],l=n||document.location.pathname||"/",c=r||document.body,h=[];try{u=new Router}catch(a){throw Error("<"+s.join(",")+"> are missing classes?")}finally{if(!u)throw Error("missing a valid router!")}return e=function(t){var r,n,e,i={};u.map(function(r){i=t.apply(o,[r])||{}});for(r in i)e=i[r],this[r]="function"==typeof e?{setup:e}:e,this[r].events=null!==(n=this[r].events||null)?n:{},u.handlers[r]=this[r]},i=function(t){for(var r,n,o=0,i=t.length;i>o;o+=1){if("function"!=typeof t[o])throw Error("<"+t[o]+"> is not a module!");if(r=new t[o],!r.initialize_module||"function"!=typeof r.initialize_module)throw n=t[o]+"",n=/\s(.+?)\b/.exec(n)[1],Error("<"+n+"#initialize_module> is missing!");r.initialize_module({draw:e}),t[o]={module:r,klass:n}}return t},o={title:"",router:u,history:[l],context:{$:{},el:c,uri:l,locals:{},send:function(r,n){var e,i=0;for(r="object"==typeof r&&r.length?r:[r],n="object"==typeof n&&n.length===t?n:{},e=r.length;e>i;i+=1)r[i].apply(o.context,[n])}},run:function(){if(!h||0===h.length)throw Error("<App#load> cannot run without modules!");if("string"!=typeof this.context.uri||0!==this.context.uri.indexOf("/"))throw Error("<"+this.context.uri+"> missing root slash!");try{u.handleURL(this.context.uri)}catch(t){throw Error("<"+this.context.uri+"> unknown route!")}return this},load:function(t){var r,n;if("function"==typeof t&&(t=[t]),!t||0===t.length)throw Error("<App#load> require some modules!");t=i(t);for(r in t)n=t[n],h.push(n);return this},url:function(t,r){try{return u.recognizer.generate(t,r)}catch(n){throw Error("<"+t+"> route not found or missing params!")}},go:function(t,r){u.redirectURL(t,null==r?!0:r)}},u.handlers={},u.updateURL=function(t){history.pushState({},o.title,t)},u.getHandler=function(t){return u.handlers[t]||{}},u.redirectURL=function(t,r){try{u.handleURL(t)}catch(n){throw Error("<"+t+"> unknown route!")}!1!==r&&(o.history.push(t),u.updateURL(t))},o}}()})(this);