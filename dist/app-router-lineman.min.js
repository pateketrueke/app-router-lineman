/*! app-router-lineman - v0.3.0 - 2013-08-10 */
(function(t){"use strict";t.App=function(t){return function(n,e){var r,o,i,u,c,f,l,a,s,p,d=e||document.location.pathname||"/",h=n||document.body;return u=new Router,c=function(t,n){var e,r={};if("function"==typeof n)return function(){return n.apply(t,arguments)};for(e in n)r[e]=c(t,n[e]);return r},f=function(t){return t},a=function(n,e,o){return"boolean"==typeof e&&(o=e,e=t),"/"!==(n+"").charAt(0)&&(n=r.context.url(n,e||{})),o=e&&e.update||o,o=null==o?!0:o,[n,e||{},o]},p=function(t){return function(n){return n&&n.preventDefault&&n.preventDefault(),r.context.go(t),!1}},l=function(t,n){var e,r,o=document.createElement("a");s=a(t,n),r=s.shift(),n=s.shift(),o.innerHTML=t,o.href=r,o.click?n.addEventListener?o.addEventListener("click",p(r),!1):o.onclick=p(r):o.click=p(r);for(e in n)o[e]=n[e];return o},o=function(t){var n,e,o,i={};e=this,u.map(function(n){i=t.apply(e,[n])||{}});for(n in i)o=i[n],this[n]="function"==typeof o?{setup:o}:o,"model"in this[n]||(this[n].model=f),u.handlers[n]=c(r.context,this[n])},i=function(t){var n,e;for(n in t){if(isNaN(parseInt(n,10))?e=n:(e=t[n]+"",e=/\s(.+?)\b/.exec(e)[1]),"function"!=typeof t[n])throw Error("<"+e+"> is not a module!");if(n=new t[n](r),!n.initialize_module||"function"!=typeof n.initialize_module)throw Error("<"+e+"#initialize_module> is missing!");r.context.send(n.initialize_module,{draw:c(n,o)}),t[e]=n}return t},r={router:u,modules:{},context:{$:{},el:h,uri:d,globals:{},helpers:{},send:function(n,e){var o,i=0;for(n="object"==typeof n&&n.length?n:[n],e="object"==typeof e&&e.length===t?e:{},o=n.length;o>i;i+=1)n[i].apply(r.context,[e])},link:function(t,n,e){return l(t,n,e)},url:function(t,n){try{return u.recognizer.generate(t,n)}catch(e){throw Error("<"+t+"> route not found or missing params!")}},go:function(t,n,e){s=a(t,n,e),u.redirectURL(s.shift(),s.pop())}},run:function(){if(!this.modules||0===this.modules.length)throw Error("<App#load> cannot run without modules!");return this.context.go(this.context.uri,!1)},load:function(t){var n,e;if("object"!=typeof t&&(t=[t]),!t||0===t.length)throw Error("<App#load> require some modules!");t=i(t);for(n in t)this.modules[n]||"object"!=typeof t[n]||(e=t[n],this.modules[n]=e);return this}},u.handlers={},u.updateURL=function(t){history.pushState({},r.title,t)},u.getHandler=function(t){return u.handlers[t]||{}},u.redirectURL=function(t,n){!1!==n?(u.updateURL(t),u.handleURL(t)):u.handleURL(t)},r}}(),t.App.modules=function(){var n,e={};for(n in t.App)n.charAt(0)===n.charAt(0).toUpperCase()&&(e[n]=t.App[n]);return e}})(window||this);