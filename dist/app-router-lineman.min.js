/*! app-router-lineman - v0.1.1 - 2013-07-13 */
(function(t){"use strict";t.App=function(t){return function(n,r){var o,e,i,u,l=["Router","RouteRecognizer","RSVP"],a=r||document.location.pathname||"/",c=n||document.body,s=[];try{u=new Router}catch(h){throw Error("<"+l.join(",")+"> are missing classes?")}finally{if(!u)throw Error("missing a valid router!")}return e=function(t){var n,r,e,i={};u.map(function(n){i=t.apply(o.context,[n])||{}});for(n in i)e=i[n],this[n]="function"==typeof e?{setup:e}:e,this[n].events=null!==(r=this[n].events||null)?r:{},u.handlers[n]=this[n]},i=function(t){for(var n,r,i=0,u=t.length;u>i;i+=1){if("function"!=typeof t[i])throw Error("<"+t[i]+"> is not a module!");if(n=new t[i],!n.initialize_module||"function"!=typeof n.initialize_module)throw r=t[i]+"",r=/\s(.+?)\b/.exec(r)[1],Error("<"+r+"#initialize_module> is missing!");n.initialize_module.apply(o.context,[{draw:e}]),t[i]=n}return t},o={name:"Lineman",router:u,history:[a],context:{$:{},el:c,uri:a,globals:{},helpers:{url_for:function(t,n){return o.url(t,n)},link_to:function(t){return t.link(o.url(t))}},send:function(n,r){var e,i=0;for(n="object"==typeof n&&n.length?n:[n],r="object"==typeof r&&r.length===t?r:{},e=n.length;e>i;i+=1)n[i].apply(o.context,[r])}},run:function(){if(!s||0===s.length)throw Error("<App#load> cannot run without modules!");return this.go(this.context.uri,!1)},load:function(t){var n,r;if("function"==typeof t&&(t=[t]),!t||0===t.length)throw Error("<App#load> require some modules!");t=i(t);for(n in t)r=t[n],s.push(r);return this},url:function(t,n){try{return u.recognizer.generate(t,n)}catch(r){throw Error("<"+t+"> route not found or missing params!")}},go:function(t,n){return u.redirectURL(t,null==n?!0:n),this}},u.handlers={},u.updateURL=function(t){history.pushState({},o.title,t)},u.getHandler=function(t){return u.handlers[t]||{}},u.redirectURL=function(t,n){try{u.handleURL(t)}catch(r){throw Error("<"+t+"> unknown route!")}!1!==n&&(o.history.push(t),u.updateURL(t))},o}}()})(this);