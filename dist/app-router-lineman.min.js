/*! app-router-lineman - v0.2.1 - 2013-08-07 */
(function(t){"use strict";t.App=function(t){return function(n,e){var r,o,i,u,c,l,a,f,s,h=e||document.location.pathname||"/",p=n||document.body,d=[];return u=new Router,c=function(t){return t},a=function(n,e,o){return"boolean"==typeof e&&(o=e,e=t),"/"!==(n+"").charAt(0)&&(n=r.context.url(n,e||{})),o=e&&e.update||o,o=null==o?!0:o,[n,e||{},o]},s=function(t){return function(n){return n&&n.preventDefault&&n.preventDefault(),r.context.go(t),!1}},l=function(t,n){var e,r,o=document.createElement("a");f=a(t,n),r=f.shift(),n=f.shift(),o.innerHTML=t,o.href=r,o.click?n.addEventListener?o.addEventListener("click",s(r),!1):o.onclick=s(r):o.click=s(r);for(e in n)o[e]=n[e];return o},o=function(t){var n,e,r,o,i={};e=this,u.map(function(n){i=t.apply(e,[n])||{}});for(n in i)o=i[n],this[n]="function"==typeof o?{setup:o}:o,this[n].events=null!==(r=this[n].events||null)?r:{},u.handlers[n]=this[n],"model"in this[n]||(this[n].model=c)},i=function(t){var n,e,i;n=function(t,n){return function(e){return n.apply(t,[e])}};for(e in t){if(isNaN(parseInt(e,10))?i=e:(i=t[e]+"",i=/\s(.+?)\b/.exec(i)[1]),"function"!=typeof t[e])throw Error("<"+i+"> is not a module!");if(e=new t[e](r),!e.initialize_module||"function"!=typeof e.initialize_module)throw Error("<"+i+"#initialize_module> is missing!");r.context.send(e.initialize_module,{draw:n(e,o)}),t[i]=e}return t},r={router:u,history:[h],context:{$:{},el:p,uri:h,globals:{},helpers:{},send:function(n,e){var o,i=0;for(n="object"==typeof n&&n.length?n:[n],e="object"==typeof e&&e.length===t?e:{},o=n.length;o>i;i+=1)n[i].apply(r.context,[e])},link:function(t,n,e){return l(t,n,e)},url:function(t,n){try{return u.recognizer.generate(t,n)}catch(e){throw Error("<"+t+"> route not found or missing params!")}},go:function(t,n,e){f=a(t,n,e),u.redirectURL(f.shift(),f.pop())}},run:function(){if(!d||0===d.length)throw Error("<App#load> cannot run without modules!");return this.context.go(this.context.uri,!1)},load:function(t){var n,e;if("object"!=typeof t&&(t=[t]),!t||0===t.length)throw Error("<App#load> require some modules!");t=i(t);for(n in t)e=t[n],d.push(e);return this}},u.handlers={},u.updateURL=function(t){history.pushState({},r.title,t)},u.getHandler=function(t){return u.handlers[t]||{}},u.redirectURL=function(t,n){!1!==n?(r.history.push(t),u.updateURL(t),u.handleURL(t)):u.handleURL(t)},r}}(),t.App.modules=function(){var n,e={};for(n in t.App)n.charAt(0)===n.charAt(0).toUpperCase()&&(e[n]=t.App[n]);return e}})(this);