/*! app-router-lineman - v0.1.3 - 2013-07-14 */
(function(t){"use strict";t.App=function(n){return function(e,r){var o,i,u,c,l,a,f,s,h,d=["Router","RouteRecognizer","RSVP"],p=r||document.location.pathname||"/",m=e||document.body,g=[];for(o in d)if(!t[d[o]])throw Error("<"+d[o]+"> missing class!");return c=new Router,l=function(t){return t},f=function(t,e,r){return"boolean"==typeof e&&(r=e,e=n),"/"!==(t+"").charAt(0)&&(t=o.url(t,e||{})),r=e&&e.update||r,r=null==r?!0:r,[t,e||{},r]},h=function(t){return function(n){return n.preventDefault(),o.go(t),!1}},a=function(t,n){var e,r,o=document.createElement("a");s=f(t,n),r=s.shift(),n=s.shift(),o.innerHTML=t,o.href=r,n.addEventListener?o.addEventListener("click",h(r),!1):o.onclick=h(r);for(e in n)o[e]=n[e];return o},i=function(t){var n,e,r,i={};c.map(function(n){i=t.apply(o.context,[n])||{}});for(n in i)r=i[n],this[n]="function"==typeof r?{setup:r}:r,this[n].events=null!==(e=this[n].events||null)?e:{},c.handlers[n]=this[n],"model"in this[n]||(this[n].model=l)},u=function(t){for(var n,e,r=0,u=t.length;u>r;r+=1){if("function"!=typeof t[r])throw Error("<"+t[r]+"> is not a module!");if(n=new t[r],!n.initialize_module||"function"!=typeof n.initialize_module)throw e=t[r]+"",e=/\s(.+?)\b/.exec(e)[1],Error("<"+e+"#initialize_module> is missing!");n.initialize_module.apply(o.context,[{draw:i}]),t[r]=n}return t},o={name:"Lineman",router:c,history:[p],context:{$:{},el:m,uri:p,globals:{},helpers:{},send:function(t,e){var r,i=0;for(t="object"==typeof t&&t.length?t:[t],e="object"==typeof e&&e.length===n?e:{},r=t.length;r>i;i+=1)t[i].apply(o.context,[e])}},run:function(){if(!g||0===g.length)throw Error("<App#load> cannot run without modules!");return this.go(this.context.uri,!1)},load:function(t){var n,e;if("function"==typeof t&&(t=[t]),!t||0===t.length)throw Error("<App#load> require some modules!");t=u(t);for(n in t)e=t[n],g.push(e);return this},link:function(t,n,e){return a(t,n,e)},url:function(t,n){try{return c.recognizer.generate(t,n)}catch(e){throw Error("<"+t+"> route not found or missing params!")}},go:function(t,n,e){return s=f(t,n,e),c.redirectURL(s.shift(),s.pop()),this}},c.handlers={},c.updateURL=function(t){history.pushState({},o.title,t)},c.getHandler=function(t){return c.handlers[t]||{}},c.redirectURL=function(t,n){try{!1!==n?(o.history.push(t),c.updateURL(t),c.handleURL(t)):c.handleURL(t)}catch(e){throw Error("<"+t+"> unknown route!")}},o}}()})(this);