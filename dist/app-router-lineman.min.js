/*! app-router-lineman - v0.1.2 - 2013-07-14 */
(function(t){"use strict";t.App=function(n){return function(r,o){var e,i,u,l,c=["Router","RouteRecognizer","RSVP"],s=o||document.location.pathname||"/",a=r||document.body,f=[];for(e in c)if(!t[c[e]])throw Error("<"+c[e]+"> missing class!");return l=new Router,i=function(t){var n,r,o,i={};l.map(function(n){i=t.apply(e.context,[n])||{}});for(n in i)o=i[n],this[n]="function"==typeof o?{setup:o}:o,this[n].events=null!==(r=this[n].events||null)?r:{},l.handlers[n]=this[n]},u=function(t){for(var n,r,o=0,u=t.length;u>o;o+=1){if("function"!=typeof t[o])throw Error("<"+t[o]+"> is not a module!");if(n=new t[o],!n.initialize_module||"function"!=typeof n.initialize_module)throw r=t[o]+"",r=/\s(.+?)\b/.exec(r)[1],Error("<"+r+"#initialize_module> is missing!");n.initialize_module.apply(e.context,[{draw:i}]),t[o]=n}return t},e={name:"Lineman",router:l,history:[s],context:{$:{},el:a,uri:s,globals:{},helpers:{url_for:function(t,n){return e.url(t,n)},link_to:function(t){return t.link(e.url(t))}},send:function(t,r){var o,i=0;for(t="object"==typeof t&&t.length?t:[t],r="object"==typeof r&&r.length===n?r:{},o=t.length;o>i;i+=1)t[i].apply(e.context,[r])}},run:function(){if(!f||0===f.length)throw Error("<App#load> cannot run without modules!");return this.go(this.context.uri,!1)},load:function(t){var n,r;if("function"==typeof t&&(t=[t]),!t||0===t.length)throw Error("<App#load> require some modules!");t=u(t);for(n in t)r=t[n],f.push(r);return this},url:function(t,n){try{return l.recognizer.generate(t,n)}catch(r){throw Error("<"+t+"> route not found or missing params!")}},go:function(t,n){return l.redirectURL(t,null==n?!0:n),this}},l.handlers={},l.updateURL=function(t){history.pushState({},e.title,t)},l.getHandler=function(t){return l.handlers[t]||{}},l.redirectURL=function(t,n){try{l.handleURL(t)}catch(r){throw Error("<"+t+"> unknown route!")}!1!==n&&(e.history.push(t),l.updateURL(t))},e}}()})(this);