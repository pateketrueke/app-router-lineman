(function(a){"use strict";var b,c,d=this,e={el:"",log:null,listen:"click doubleclick submit input change",context:d,router:null},f=function(a){return a},g=Array.prototype.slice,h=function(a){var b,c=0;for(b in a)c+=parseInt(a.hasOwnProperty(b),10);return c},i=function(a){"function"==typeof e.log&&e.log(a.stack?[String(a),a.stack.replace(/^(?=\S)/gm,"  - ")].join("\n"):a)},j=function(a,b){var c,d,e;try{c="function"==typeof b&&b()}catch(f){throw e=-1===String(f).indexOf("route not found")?"errorHandler":"notFound",i(f),"function"==typeof a.classes[e]&&(d=new a.classes[e],"function"==typeof d.exception&&d.exception(f)),f}return c},k=function(a,b){var c=this;return function(){var d=arguments;return j(a,function(){return"function"==typeof b&&b.apply(c,d)})}},l=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},m=function(a,b){var c;if("object"==typeof b)for(c in b)"function"==typeof b[c]&&(b[c]=m(a,b[c]));else if("function"==typeof b)return function(){return b.apply(a,arguments)};return b},n=function(a){return a.replace(/[._-][a-z]/g,function(a){return a.substr(1).toUpperCase()})},o=function(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})},p=function(a,b){this[a]=b},q=function(){var a,b=g.call(arguments),c=b.shift();return this[c]&&(a=this[c]),b.length?q.apply(a,b):a},r=function(b,c,d){return"boolean"==typeof c&&(d=c,c=a),"object"==typeof b&&(c=b,b=c.to||a,delete c.to),d=c&&c.update||d,d=2===arguments.length||d?!0:d,[b,c||{},d]},s=function(a,b){var c=n(b);if(a.classes[c])return a.handlers[c]||(a.handlers[c]=u(a,c)),a.handlers[c];throw new Error("<"+c+"> undefined handler!")},t=function(a,b){var c,d;c=function(b,c){return function(e){var f;f=c.routes?e(c.path).to(b,d(c.routes)):e(c.path).to(b),c.params&&f.withQueryParams.apply(f,c.params),a.classes[b]=c.handler(a)}},d=function(a){return function(b){var d;for(d in a)"object"==typeof a[d]&&c(d,a[d])(b)}},a.router.map(d(b))},u=function(b,c){var d;return d=new b.classes[c],x(b,d),y(b,c,d),d.exit=v(b,c,d.exit||a),d},v=function(b,c,d){return function(){for(var e,f="function"==typeof d?d.apply(null,arguments):a;b.classes[c].partials.length;)e=b.classes[c].partials.pop(),b.handlers[c][e]().view.teardown();return delete b.handlers[c],f}},w="enter setup serialize".split(" "),x=function(b,c){var d;"model"in c||(c.model=f),"object"==typeof c.events&&(c.events=m(c,c.events)),c.events=c.events||{},c.events.error=k.call(c,b,c.events.error||a);for(d in w)c[w[d]]=k.call(c,b,c[w[d]])},y=function(a,b,c){var d,e=a.classes[b];if(e.partials=[],c.partials)for(d in c.partials)c[d]=z(a,b,d),e.partials.push(d)},z=function(a,b,c){var d;return function(e,f){var g,h="#"+o(b)+"__"+o(c);return(!d||f)&&(d&&f&&d.view.teardown(),d=new a.classes[b][c],g=d.view||{},g.el=g.el||h,g.data=g.data||e||{},g.template=g.template||h+"-partial",d.view=j(a,function(){return new Ractive(g)}),d.setup&&"function"==typeof d.setup&&d.setup()),d}},A=function(a,d){var e,f;if(c&&c.off("**"),a){c=$(a),e="string"==typeof d?d.split(" "):d;for(f in e)E(b,e[f])}},B=function(a){var c={};return b||(b=D(c),C(b)),a&&H.setup(a),b},C=function(a){var b,c,d;"undefined"!=typeof window&&(b=window,d=window.history,c=window.document),b=e.context.window||b||{},c=e.context.document||c||{},d=e.context.history||d||{},b.addEventListener?b.addEventListener("popstate",F(a)):b.attachEvent?b.attachEvent("popstate",F(a)):b.onpopstate=F(a),l(a.router,{log:i,updateURL:function(a){d.pushState&&d.pushState({to:a},c.title,a)},replaceURL:function(a){d.replaceState&&d.replaceState({to:a},c.title,a)},getHandler:function(b){var c=s(a,b);return A(e.el,e.listen),c},redirectURL:function(b,c){return!1!==c?(a.router.updateURL(b),a.history.push({to:b})):a.router.replaceURL(b),a.router.handleURL(b)}})},D=function(){var a,b={};return a={router:e.router,history:[],classes:{},handlers:{},element:e.el,set:function(a,c){return p.call(b,a,c)},get:function(a){return q.apply(b,a.split("."))},url:function(b,c){return j(a,function(){return a.router.recognizer.generate(b,c)})},route:function(b,c){var d;2===arguments.length&&(d={},d[b]=c,b=d),t(a,b)},go:function(b,c,d){var e=r(b,c,d);return c=e[1]||{},d=e[2],b=e[0],j(a,function(){if("/"===b.charAt(0)){if(!a.router.recognizer.recognize(b))throw new Error("<"+b+"> route not found!");return a.router.redirectURL(b,d)}return d?a.router.redirectURL(a.url(b,c),!0):h(c)?a.router.replaceWith(b,c):a.router.replaceWith(b)})},run:function(b){for(var c;G.length;)c=G.shift(),c.call(a,a.classes);return t(a,a.classes),"function"==typeof b&&b(a),a}}},E=function(a,b){c.on(b+".action",".js-action",function(c){var d,e,f,g,h,i,j;for(d in a.router.currentHandlerInfos)if(g=a.router.currentHandlerInfos[d].handler,"object"==typeof g.actions){j=$(c.currentTarget),e=j.data("action");for(i in g.actions)f=i.split(".")[0],e===f&&i.lastIndexOf("."+b)>0&&(h=k.call(g,a,g[g.actions[i]])(c,j))}return h})},F=function(a){return function(b){b.state&&b.state.to&&a.router.handleURL(b.state.to)}},G=[],H=function(a){G.push(a)};H.scope=function(a){return B(a)},H.setup=function(a){var b,c={};if("function"==typeof a&&(a=a.call(c,c),a="object"==typeof a?a:c),"object"==typeof a)for(b in a)e[b]=a[b]||e[b];return H},H.version={major:0,minor:9,micro:1,date:20140203},"object"==typeof exports?module.exports=H:"function"==typeof define&&define.amd?define([],function(){return H}):this.thinner=H}).call(this);