/*! Thinner - v0.6.0 - 2013-10-08 */
(function(a){var b,c,d=this,e=this.window,f=this.document,g=e.history,h=[],i={el:"body",listen:"click doubleclick submit input change",templates:d.JST||{}},j="enter setup serialize".split(" "),k=function(b,c){var d;"model"in c||(c.model=n),"object"==typeof c.events&&(c.events=t(c,c.events)),c.events=c.events||{},c.events.error=B.call(c,b,c.events.error||a);for(d in j)c[j[d]]=B.call(c,b,c[j[d]])},l=function(a){return a.replace(/[._-][a-z]/g,function(a){return a.substr(1).toUpperCase()})},m=function(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})},n=function(a){return a},o=Array.prototype.slice,p=function(a){var b,c=0;for(b in a)c+=parseInt(a.hasOwnProperty(b),10);return c},q=function(){var a;if(!(a=d.Zepto||d.jQuery||d.$))throw new Error("jQuery-compatible library is required!");return arguments.length?a.apply(a,arguments):a},r=function(b,c,d){return function(){for(var e,f="function"==typeof d?d.apply(null,arguments):a;e=b.handlers[c].partials.pop();)b.handlers[c][e]().view.teardown();return delete b.handlers[c],f}},s=function(b,c){var d;return d=new b.classes[c](b),k(b,d),D(b,c,d),d.exit=r(b,c,d.exit||a),d},t=function(a,b){var c;if("object"==typeof b)for(c in b)"function"==typeof b[c]&&(b[c]=t(a,b[c]));else if("function"==typeof b)return function(){return b.apply(a,arguments)};return b},u=function(b,c,d){return"boolean"==typeof c&&(d=c,c=a),"object"==typeof b&&(c=b,b=c.to||a,delete c.to),d=c&&c.update||d,d=null==d?!0:d,[b,c||{},d]},v=function(a,b){var c;for(c in b){if("function"!=typeof b[c])throw new Error("<"+b[c]+"> is not a module!");a.modules.push(new b[c](a))}},w=function(a){return function(b){b.state&&b.state.to&&a.router.handleURL(b.state.to)}},x=function(a,b){var c=l(b);if(a.classes[c])return a.handlers[c]||(a.handlers[c]=s(a,c)),a.handlers[c];throw new Error("<"+c+"> undefined handler!")},y=function(a){var b,c={};return b={router:new Router,history:[],modules:[],classes:{},handlers:{},helpers:{},imports:{},exports:function(a,c){var d={};"function"==typeof c?d[a]=c:d=a,I(b.imports,t(b,d))},render:function(a,c){return H(a,c,b.helpers)},set:function(a,b){return G.call(c,a,b)},get:function(a){return F.apply(c,a.split("."))},url:function(a,c){return C(b,function(){return b.router.recognizer.generate(a,c)})},go:function(a,c,d){var e=u(a,c,d);return c=e[1]||{},d=e[2],a=e[0],C(b,function(){if("/"===a.charAt(0)){if(!b.router.recognizer.recognize(a))throw new Error("<"+a+"> route not found!");return b.router.redirectURL(a,d)}return d?b.router.redirectURL(b.url(a,c),!0):p(c)?b.router.replaceWith(a,c):b.router.replaceWith(a)},RSVP.reject())},load:function(a){if("object"!=typeof a&&(a=a&&[a]),!a||0===a.length)throw new Error("That require some modules!");return v(b,a),b},run:function(c){var d;for(d in a)"_"!==d.charAt(0)&&d.charAt(0)===d.charAt(0).toUpperCase()?b.load(a[d]):b.classes[d]=a[d];return"function"==typeof c&&c(b),b}}},z=function(){var a,b,c,d={},j=y(d);for(a in h)h[a].call(j,d);for(e.addEventListener?e.addEventListener("popstate",w(j)):e.attachEvent?e.attachEvent("popstate",w(j)):e.onpopstate=w(j),b="string"==typeof i.listen?i.listen.split(" "):i.listen;c=b.pop();)A(j,c);return j.router.updateURL=function(a){g.pushState({to:a},f.title,a)},j.router.replaceURL=function(a){g.replaceState({to:a},f.title,a)},j.router.getHandler=function(a){return x(j,a)},j.router.redirectURL=function(a,b){return!1!==b?(j.router.updateURL(a),j.history.push({to:a})):j.router.replaceURL(a),j.router.handleURL(a)},j},A=function(a,b){c.on(b+".action",".js-action",function(c){var d,e,f,g,h,i,j;for(d in a.router.currentHandlerInfos)if(g=a.router.currentHandlerInfos[d].handler,"object"==typeof g.actions){j=q(c.currentTarget),e=j.data("action");for(i in g.actions)f=i.split(".")[0],e===f&&i.lastIndexOf("."+b)>0&&(h=B.call(g,a,g[g.actions[i]])(c,j))}return h})},B=function(a,b){var c=this;return function(){var d=arguments;return C(a,function(){return"function"==typeof b&&b.apply(c,d)})}},C=function(a,b,c){var d,e,f;try{d="function"==typeof b&&b()}catch(g){if(f=-1===String(g).indexOf("route not found")?"errorHandler":"notFound","function"==typeof a.classes[f]&&(e=new a.classes[f](a),"function"==typeof e.exception))return e.exception(g),c;throw g}return d},D=function(a,b,c){var d;c.partials=[];for(d in a.classes[b]){if(d in c)throw new Error("<"+partials[length]+"> already defined!");c[d]=E(a,b,d),c.partials.push(d)}},E=function(a,b,c){var d;return function(e,f){var g,h="#"+m(b)+"__"+m(c);return(!d||f)&&(d&&f&&d.view.teardown(),d=new a.classes[b][c](a),g=d.view||{},g.el=g.el||h,g.data=g.data||e||{},g.template=g.template||h+"-partial",d.view=C(a,function(){return new Ractive(g)}),d.setup()),d}},F=function(){var a,b=o.call(arguments),c=b.shift();return this[c]&&(a=this[c]),b.length?F.apply(a,b):a},G=function(a,b){this[a]=b},H=function(a,b,c){var d,e={};if(b=b||{},a=a||"undefined",d="app/templates/"+a.replace(/[^\w_-]/g,"/"),!(d=i.templates[d]||i.templates[a]))throw new Error("Missing '"+a+"' view!");I(e,b),I(e,c),e.partial=H;try{return d.call(null,e)}catch(f){throw new Error(String(f)+" ("+a+")")}},I=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},J=function(a){h.push(a)};J.loader=function(a){return b||(J.setup(a),c=q(i.el||"body",f),b=z()),b},J.setup=function(a){var b,c={};if("function"==typeof a&&(a=a.call(c,c),a="object"==typeof a?a:c),"object"==typeof a)for(b in a)i[b]=a[b]||i[b]},"undefined"!=typeof module&&module.exports?module.exports=J:"function"==typeof define&&define.amd?define(function(){return J}):this.thinner=J}).call(this);